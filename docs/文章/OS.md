# 操作系统面试题

## 进程间通信方式？管道模型的分类？

回答 1：

- 管道（Pipe）：单向通信，适用于有亲缘关系的进程（父子进程）之间通信
  - 优点：简单易用，适用于单向通信
  - 缺点：只能在有亲缘关系的进程之间使用，且只能实现单向通信
- 命名管道（Named Pipe）：允许无亲缘关系的进程之间通信
  - 优点：允许无亲缘关系的进程通信
  - 缺点：只能实现单向通信
- 消息队列（Message Queue）：实现进程间的异步通信，通过消息缓冲区传递数据
  - 优点：支持异步通信，可以实现多对多通信
  - 缺点：复杂度较高，需要处理消息的发送和接收
- 共享内存（Shared Memory）：多个进程共享同一块内存区域，实现高效的数据交换
  - 优点：高效，适合大数据量的共享
  - 缺点：需要处理同步和互斥问题，可能引起数据一致性和安全问题
- 信号量（Semaphore）：用于进程间的同步和互斥控制
  - 优点：可以实现进程间的同步和互斥
  - 缺点：复杂度较高，需要处理信号量的管理
- 套接字（Socket）：适用于不同主机之间的进程通信，可以实现网络通信
  - 优点：跨主机通信，支持多种通信协议
  - 缺点：相比于其他方式，套接字通信开销较大

回答 2：

- 最简单的方式就是管道，管道分为“匿名管道“和”命名管道”。
	- “匿名管道”顾名思义，它没有文字标识，是一种特殊的文件，只存在于内存，没有存在于文件系统中，shell 命令中的竖线 `|` 就是匿名管道，通信的数据是无格式的流并且大小受限，通信方式是单向的，数据只能在一个方向上流动，如果要双向通信，需要创建两个管道。匿名管道只能用于存在父子关系的进程间通信，匿名管道的生命周期随着进程创建而建立，随着进程终止而消失
	- 命名管道突破了匿名管道只能在亲缘关系进程间进行通信的限制，因为使用命名管道前，需要在文件系统中创建一个类型为 p 的设备文件，那么毫无关系的两个进程就可以通过这个设备文件进行通信。另外，不管是匿名管道还是命名管道，进程写入的数据都是缓存在内核中，另一个进程读取数据时自然也是从内核中读取，同时通信数据都遵循先进先出的原则
- 消息队列解决了管道通信的数据是无格式的字节流的问题，消息队列实际上是保存在内核中的**消息链表**，用户可以自定义消息体的数据类型，发送数据时，会被分成一个个独立的消息体，接收数据时，也要于发送方发送的消息提的数据类型保持一致，这样才能保证正确读取数据。消息队列通信的速度不是最及时的，毕竟每次数据的写入和读取都需要经过用户态与内核态之间的拷贝过程
- 共享内存可以解决消息队列通信中用户态与内核态之间数据拷贝过程带来的开销，它直接分配一个共享空间，每个进程都可以直接访问，就像访问进程自己的空间一样快捷方便，不需要陷入内核态或者系统调用，大大提高了通信速度，**享有最快的通信方式之名**。但是便捷高效的共享内存通信，带来新的问题，多进程竞争同个共享资源会造成数据的错乱
- 这时需要信号量来保护共享资源，以确保任何时刻只能有一个进程访问共享资源，这种方式就是互斥访问。信号量不仅可以实现访问的互斥行，还可以实现进程间的同步，信号量其实是一个计数器，表示的是资源个数，其值可以通过两个原子操作来控制，分别是 P 操作和 V 操作
- 与信号量名字很相似的叫信号，名字虽然相似，但功能不一样。信号可以在应用进程和内核之间直接交互，内核也可以利用信号来通知用户空间的进程发生了哪些系统事件，信号事件的来源主要有硬件来源（如 Ctrl+C）和软件来源（如 kill 命令），一旦有信号发生，进程有三种响应方式：1）执行默认操作，2）捕捉信号，3）忽略信号。`SIGKILL` 和 `SIGSTOP` 是应用进程无法捕捉和忽略的，为了方便我们能在任何时候结束或停止某个进程
- Socket 用于不同主机的进程间通信，还可用于本地主机进程间通信。根据创建 Socket 类型不同可分为三种常见的通信方式：1）基于 TCP 协议的通信方式，2）基于 UDF 协议的通信方式，3）本地进程间通信方式

## 线程间的通信有哪些？有什么作用？

Linux 系统中，线程间的通信方式包括：

- 互斥锁（Mutex）：线程可以使用互斥锁保护共享资源，确保同时只有一个线程可以访问该资源
- 条件变量：线程可以使用条件变量等待特定条件的发生，以实现线程间的协调和通知
- 信号量：线程可以使用信号量来控制对共享资源的访问，实现线程间的同步和互斥
- 都写锁：允许多个线程读取共享资源，但只允许一个线程写入共享资源

## 虚拟内存是什么？有什么作用？

虚拟内存（Virtual Memory）是计算机系统内存管理的一种技术。它使内存管理更为高效，编写大型程序也变得容易[1]。应用程序直接访问虚拟内存，操作系统完成虚拟内存到物理内存的映射，一段连续的虚拟内存，通常会映射到多个物理内存碎片区域。编写程序时，操作系统为每个进程分配独立的虚拟内存，内存之间是互斥的。

虚拟内存的作用？

- 内存管理和分配：虚拟内存允许操作系统将物理和内存和磁盘空间组合成一个更大的虚拟地址空间，使得操作系统可以更灵活地管理内存资源，当物理内存不足时，根据程序运行的局部性原理，可能将一部分不常用的数据转移到磁盘上，腾出空间给其他进程使用
- 地址空间隔离：每个进程都有自己的页表，所以每个进程的虚拟内存空间就是独立的，进程没办法访问到其他进程的页表，所以这些页表是私有的，解决了多线程之间的地址冲突问题

## 内核态和用户态区别？内核态的底层操作有什么？为什么要分为两个不同的态？

内核态和用户态是操作系统的两种运行模式，他们主要区别在于权限和可执行的操作：

- 内核态（Kernel Mode）：在内核态下，CPU 可以执行所有的指令和访问所有的硬件资源。在这种模式下的操作具有更高的权限，主要用于操作系统内核的运行。
- 用户态（User Mode）：在用户态下，CPU 只能执行部分指令集，无法直接访问硬件资源。这种模式下的操作权限较低，主要用于运行用户程序

内核态的底层操作主要包括：

- 内存管理
- 进程管理
- 设备驱动程序控制
- 系统调用

这些操作设计到操作系统的核心功能，需要较高的权限来执行。

分为内核态和用户态的原因主要有以下几点：

1. 安全性：通过对权限的划分，用户程序无法直接访问硬件资源，从而避免了恶意程序对系统资源的破坏
2. 稳定性：用户态程序出现问题时，不会影响到整个系统，避免了程序故障导致系统崩盘的风险
3. 隔离性易维护：这种划分是操作系统内核于用户程序直接有了明确的边界，有利于系统的模块化和维护

## 软连接和硬连接的区别是什么？

- 软连接是指向目标文件路径的符号连接，类似于 Windows 中的快捷方式，创建软连接不会占用目标文件的 inode 节点，指示简单地指向目标文件中的路径。删除原始文件后，软连接仍然存在，但指向的目标文件失效，称为“悬空”连接。软连接可以跨文件系统创建软连接
- 硬连接是指多个文件实际上指向的是同一个 inode 节点，即多个文件共享同一个数据块。创建硬连接会增加目标文件的连接计数，删除任何一个硬连接不会影响其他硬链接指向的文件计数。只能在同一个文件系统内创建硬连接

## 参考

1. 虚拟内存 wiki：https://zh.wikipedia.org/wiki/%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98
