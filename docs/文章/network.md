# 计算机网络面试题

## 输入网址后发生了什么？

应用层 DNA 解析，传输层 TCP 连接，网络层 IP，数据链路 MAC，真实物理层，接收到之后再一层层扒皮。

## DNS 解析的具体过程

DNS 域名解析就是把域名翻译成 ip 地址的过程，例如将 www.baidu.com 翻译成 1.2.3.4 这个 IP，总共分为以下步骤：

- 浏览器缓存检查：浏览器首先会检查自身 DNS 缓存，这个缓存只能容纳 1000 条，且缓存时间比较短，只有一分钟。如果没有查到缓存，则进行下一步
- 操作系统缓存检查 + hosts 解析：如果浏览器缓存没有查到，则会查找操作系统缓存的解析结果。Linux 可以通过 /etc/hosts 文件来设置域名对应的 ip，如果在这个文件查到了域名，会优先访问这里配置的 ip，并将这个结果缓存起来。缓存时间受域名失效时间和缓存大小控制的
- dns 解析 1：客户端通过浏览器访问域名为 www.baidu.com 的网站，发起查询该域名 ip 的 dns 请求。该请求发送到本地 dns 服务器，本地 dns 服务区首先会检查自己的缓存记录，如果缓存中有此记录，就可以直接返回结果，否则本地 dns 服务器向根服务器发起请求
- dns 解析 2：本地 dns 服务器向根服务器发送 dns 请求，请求域名为 www.baidu.com 的 ip 地址
- dns 解析 3：根服务器经过查询，没有找到该域名及 ip 的对应关系，告诉本地 dns 服务器，可以到 .com 域名服务器上继续查询
- dns 解析 4：本地 dns 服务器向 .com 服务器发送 dns 请求，请求域名为 www.baidu.com 的 ip 地址
- dns 解析 5：.com 服务器接收到请求后，不会立即返回对应 ip，而是告诉本地 dns 服务器，可以在 baidu.com 的域名服务器上请求获取 ip 地址
- dns 解析 6：本地 dns 服务器向 baidu.com 服务器发送 dns 请求，请求域名为 www.baidu.com 的 ip 地址
- dns 解析 7：baidu.com 服务器在自己的缓存表中发现了该域名和 ip 地址的对应关系，并将 ip 地址返回给本地 dns 服务器
- dns 解析 8：本地 dns 服务器将获取到域名与对应的 ip 地址返回给客户端，并将结果缓存供下次查询

## TCP 拆包沾包的原因

- TCP 协议是基于字节流的传输协议，没有固定的分包边界。发送方将数据拆分成多个小的数据包进行传输，接收方再将这些数据包组合成完整的数据。在这个过程中可能会出现拆包和沾包现象
- 网络传输中的延迟和拥塞会影响数据包发送的速度和到达接收方的顺序，可能导致数据包的拆分和组合不规律
- 接收方缓冲区大小限制。当接收方缓冲区大小小于完整数据包大小，可能会发生拆包

解决方式：

- 在应用层实现数据包的边界识别，添加包头，包头中添加数据长度等信息
- 使用固定长度的数据包或特殊的分隔符，便于数据包识别边界
- 使用更高级的传输层协议，如 WebSocket，它在 TCP 的基础上添加了数据帧的概念，可以更好地解决拆包和沾包问题

## 对称加密和非对称加密的区别？

- 对称加密是双方使用同一个密钥加解密，优点是运算速度快，缺点是安全性不高，一旦密钥泄露则有风险
- 非对称加密的安全性高，但计算速度低，一般非对称加密用在验证证书阶段，对称加密用在数据传输阶段，非对称加密的基本路程如下[1]：
	- 假设爱丽丝和鲍勃事先互不认识，也没有可靠安全的沟通通道，爱丽丝现在要通过不安全的互联网向鲍勃发送消息
	- 爱丽丝写好原文，设为 x
	- 鲍勃使用密码学安全伪随机数生成一对密钥，一个作为公钥 c，一个作为私钥 d
	- 鲍勃将公钥 c 通过不安全的互联网发送给爱丽丝，即使窃听者伊夫在中间窃听到 c 也没问题
	- 爱丽丝用公钥 c 对原文加密，得到密文 c(x)
	- 爱丽丝可以用任何方法传输密文 c(x) 给鲍勃，即使窃听者伊夫在中间窃听到 c(x) 也没问题
	- 鲍勃收到密文 f(x)，用私钥 d 对 c(x) 进行解密，即 d(c(x))，得到原始明文 x
	- 由于伊夫没有得到私钥 d，所以无法获取明文 x
	- 如果爱丽丝丢失了原文 x，在没有得到鲍勃的私钥 d 的情况下，她和伊夫一样无法通过鲍勃的公钥 c 和密文 c(x) 重新得到原文 x

## 有哪些对称加密和非对称加密的算法？

- 对称加密：
	- AES：最流行和广泛使用的算法之一，支持不同的密钥长度。如 AES-128，AES-256
- 非对称加密算法：
	- RSA：最常见的非对称加密算法，用于数据加密和数字签名
	- ECC：基于椭圆曲线的非对称加密算法，具有较高的安全性和效率，使用于移动设备等资源受限的环境

## 在信息传输过程中，HTTPS用的是对称加密还是非对称加密

HTTPS 使用的混合加密方式，对称加密和非对称加密都有。

- 在通信建立前采用非对称加密的方式交换会话密钥，后续就不再使用非对称加密
- 在通信过程中使用对称加密的会话密钥方式加密会话数据

## HTTPS 四次握手过程说一下

SSL/TLS 协议的基本流程：

- 客户端向服务端索要并验证服务器的公钥
- 双方协商生成会话密钥
- 双方使用会话密钥进行加密通信

前两步即 SSL 建立握手的阶段。TLS 协议建立的详细流程：

1. ClientHello

客户端向服务端发送加密通信请求，即 ClientHello 请求，客户端发送以下信息：

- 客户端支持的 TLS 版本，如 TLS1.2 版本
- 客户端生产的随机数（Client Random），后面用于生成“会话密钥”的条件之一
- 客户端支持的密码套件列表，如 RSA 加密算法

2. ServerHello

服务端收到客户端请求之后，向客户端发出响应，也就是 ServerHello，服务器回应以下内容：

- 确认 TLS 协议版本，如果浏览器不支持，则关闭加密通信
- 服务器生产的随机数（Server Random），也是后面用于生产会话密钥的条件之一
- 确认的密码套件列表，如 RSA 加密算法
- 服务器的数字证书

3. 客户端回应

客户端收到服务器的回应之后，首先通过浏览器或者操作系统中的 CA 公钥，确认服务器的数字证书的真实性。

如果证书没有问题，客户端会从数字证书中取出服务器的公钥，然后用它加密报文，向服务器发送如下信息：

- 一个随机数（pre-master-key），该随机数会被服务器加密
- 加密算法改变通知，表示随后的信息都将用“会话密钥”加密通信
- 客户端握手结束通知，表示客户端的握手阶段已经结束，同时把之前所有的内容做个摘要，供服务器校验

客户端和服务端有了 Client Random，Server Random，pre-master-key 之后，接着就用双方协商的加密算法，各自生成本次通信的会话密钥。

4. 服务端回应

服务器收到第三个随机数 pre-master-key 之后，通过协商的加密算法，计算出本次通信的会话密钥

然后，向客户端发送最后的信息：

- 加密通信算法改变通知，表示随后的信息都将用于“会话密钥”加密通信
- 服务器握手结束通知，表示服务器的握手阶段已经结束，这项会把之前的内容做个摘要，用来供客户端校验

至此，TLS 握手结束，接下来使用“会话密钥”加密通信内容。

## HTTPS客户端验证证书的细节？[2]

CA 机构首先进行证书签名，然后客户端进行校验。

证书签名过程：

- CA 将持有者的公钥、用途、颁发者、有效时间等信息打成一个包，然后对这些信息进行 Hash 计算，得到一个 Hash 值
- CA 使用私钥将 Hash 值加密，形成 Certificate Signature，即对证书进行签名
- 将 Certificate Signature 添加在文件证书上，形成电子证书

客户端校验证书过程：

- 客户端使用同样的 Hash 算法得到该证书的 Hash 值 H1
- 浏览器和操作系统中集成了 CA 的公钥信息，浏览器收到证书后可以使用 CA 的公钥对 Certificate Signature 解密，得到 Hash 值 H2
- 比较 H1 和 H2，如果值相同，则为可信赖的证书，否则认为证书不可信

实际上证书的签发还有一个证书信任链的问题，我们向 CA 申请的证书一般不是根证书签发的，而是由中间证书签发的。假如客户端收到的是 baidu.com 证书，层级关系如下：

- 客户端收到 baidu.com 的证书后，发现这个证书的签发者不是根证书，就无法根据本地已有的根证书中的公钥去验证 baidu.com 证书是否可信。于是，客户端根据 baidu.com 证书中的签发者，找到该证书的颁发机构是 “GlobalSign Organization Validation CA - SHA256 - G2”，然后向 CA 请求该中间证书
- 请求到证书后发现 “GlobalSign Organization Validation CA - SHA256 - G2” 证书是由 “GlobalSign Root CA” 签发的，由于 “GlobalSign Root CA” 已经是根签发机构，应用软件会检查此证书是否已预加载于跟证书清单上，如果有，则可以利用根证书中的公钥去验证“GlobalSign Organization Validation CA - SHA256 - G2”，如果验证通过，认为中间证书是可信的
- “GlobalSign Organization Validation CA - SHA256 - G2” 证书被信任后，可以使用 “GlobalSign Organization Validation CA - SHA256 - G2” 证书中的公钥去验证 baidu.com 证书的可信性，如果验证通过，就可以新增 baidu.com 证书

整个信任链路如下：

- 服务器证书的颁发者 -> 中间证书的颁发者 -> 根证书的颁发者
- 根证书自验证 -> 中间证书验证 -> 服务器证书验证

## 如何防止下载的文件被劫持和篡改？

- 使用 HTTPS 下载：确保下载链接使用 HTTPS 协议，通过 SSL 加密传输协议，防止中间人攻击和数据篡改
- 验证文件完整性：在下载文件后使用 Hash 算法（如 MD5，SHA-256）计算文件的哈希值，于官方提供的哈希值进行比对，验证文件是否被篡改

## 参考文章

1. 公开密钥加密：https://zh.wikipedia.org/wiki/%E5%85%AC%E5%BC%80%E5%AF%86%E9%92%A5%E5%8A%A0%E5%AF%86
2. 签发证书的过程：https://mp.weixin.qq.com/s/bygsszqpqCuWdC0yxd4jMA
